
# go-http-calculator

Yandex Golang Practice

## HTTP API –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä

### –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

- [–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
- [API](#api)
  - [–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è](#–≤—ã—á–∏—Å–ª–µ–Ω–∏–µ-–≤—ã—Ä–∞–∂–µ–Ω–∏—è)
  - [–°–ø–∏—Å–æ–∫ –≤—ã—Ä–∞–∂–µ–Ω–∏–π](#—Å–ø–∏—Å–æ–∫-–≤—ã—Ä–∞–∂–µ–Ω–∏–π)
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
- [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- [Front-end](#front-end)
- [–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç](#–∫–∞–∫-—ç—Ç–æ-—Ä–∞–±–æ—Ç–∞–µ—Ç)
  - [–°–µ—Ä–≤–µ—Ä (–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä)](#—Å–µ—Ä–≤–µ—Ä-–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä)
    - [–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã /api/v1/calculate](#–ø—Ä–∏–Ω—Ü–∏–ø-—Ä–∞–±–æ—Ç—ã-apiv1calculate)
    - [–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã /api/v1/expressions](#–ø—Ä–∏–Ω—Ü–∏–ø-—Ä–∞–±–æ—Ç—ã-apiv1expressions)
    - [–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã /api/v1/expressions/{id}](#–ø—Ä–∏–Ω—Ü–∏–ø-—Ä–∞–±–æ—Ç—ã-apiv1expressionsid)
  - [–ê–≥–µ–Ω—Ç](#–∞–≥–µ–Ω—Ç)

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –ë–∞–∑–æ–≤—ã–µ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (`+`, `-`, `*`, `/`)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–µ—Å—è—Ç–∏—á–Ω—ã—Ö —á–∏—Å–µ–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, `3.14`)
- –£—á–∏—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π (—Å–∫–æ–±–∫–∏, —É–º–Ω–æ–∂–µ–Ω–∏–µ, –¥–µ–ª–µ–Ω–∏–µ)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤, —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ –æ—à–∏–±–æ–∫

## API

### –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è

**Endpoint:** `POST /api/v1/calculate`

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:** `Content-Type: application/json`

#### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤

**–ó–∞–ø—Ä–æ—Å:**

```json
{
  "expression": "2+2"
}
```

**–û—Ç–≤–µ—Ç (Status 202 Accepted):**

```json
{
  "id": 1
}
```

---

**–ó–∞–ø—Ä–æ—Å —Å –æ—à–∏–±–∫–æ–π:**

```json
{
  "expression": "2+"
}
```

**–û—Ç–≤–µ—Ç (Status 422 Unprocessable Entity):**

```json
{
  "error": "unprocessable entity"
}
```

---

**–ó–∞–ø—Ä–æ—Å —Å –æ—à–∏–±–∫–æ–π –≤—ã—Ä–∞–∂–µ–Ω–∏—è:**

```json
{
  "expression": "2-2+"
}
```

**–û—Ç–≤–µ—Ç (Status 500 Internal Server Error):**

```json
{
  "error": "failed to create tasks: not enough operands for operator: +"
}
```

---

### –°–ø–∏—Å–æ–∫ –≤—ã—Ä–∞–∂–µ–Ω–∏–π

**Endpoint:** `GET /api/v1/expressions`

#### –ü—Ä–∏–º–µ—Ä—ã –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –∑–∞–ø—Ä–æ—Å

```json
{
    "expressions": [
        {
            "id": 1,
            "expression": "2+2",
            "status": "done",
            "result": 4
        },
        {
            "id": 2,
            "expression": "2/0",
            "status": "error",
            "result": 0,
            "error": "division by zero"
        },
        {
            "id": 3,
            "expression": "(3 + 5) * (2 - 6) / (4 + 7) * (8 - 3) + (10 / (2 + 3)) - (4 * (5 - 2)) + (12 / (3 + 1)) * 2 ",
            "status": "computing",
            "result": 0
        }
    ]
}
```

–£ –≤—ã—Ä–∞–∂–µ–Ω–∏–π –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç–∞—Ç—É—Å–æ–≤:

- pending - –≤ –æ—á–µ—Ä–µ–¥–∏ –Ω–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ
- computing - –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç
- done - —É—Å–ø–µ—à–Ω–æ –≤—ã—á–∏—Å–ª–µ–Ω–Ω–æ
- error - –≤–æ –≤—Ä–µ–º—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞(–µ—Å–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ)

---

### –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –ø–æ –µ–≥–æ ID

**Endpoint:** `GET /api/v1/expressions/{id}`

#### –ü—Ä–∏–º–µ—Ä—ã –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –∑–∞–ø—Ä–æ—Å

**–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID:**

```text
/api/v1/expressions/-2
```

**–û—Ç–≤–µ—Ç:**

```json
{
  "error": "expression not found"
}
```

---

**–ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID:**

```text
/api/v1/expressions/2
```

**–û—Ç–≤–µ—Ç:**

```json
{
  "id": 2,
  "expression": "(3 + 5) * (2 - 6) / (4 + 7) * (8 - 3) + (10 / (2 + 3)) - (4 * (5 - 2)) + (12 / (3 + 1)) * 2 ",
  "status": "done",
  "result": -18.545455
}
```

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å –ø–æ–º–æ—â—å—é `git clone`:

```bash
# ssh
git clone git@github.com:MoodyShoo/go-http-calculator.git
# https 
https://github.com/MoodyShoo/go-http-calculator.git
```

2. –ü–µ—Ä–µ–π—Ç–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:

```bash
cd go-http-calculator
```

3. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 8080.
   - –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ Windows:

     ```cmd
     set PORT=3000
     ```

     –∏–ª–∏

     ```powershell
     $env:PORT=3000;
     ```

   - –ò–∑–º–µ–Ω–∏—Ç—å –≤ Linux:

      ```bash
       PORT=1234
      ```

    –î–ª—è —Å–µ—Ä–≤–µ—Ä–∞ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    - TIME_ADDITION_MS - –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–ª–æ–∂–µ–Ω–∏—è
    - TIME_SUBTRACTION_MS - –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—ã—á–∏—Ç–∞–Ω–∏—è
    - TIME_MULTIPLICATIONS_MS - –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —É–º–Ω–æ–∂–µ–Ω–∏—è
    - TIME_DIVISIONS_MS - –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–ª–µ–Ω–∏—è

    –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∑–Ω–∞—á–µ–Ω–∏—è –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ä–∞–≤–Ω–æ 1000 millisec.

    ---

   –ê–≥–µ–Ω—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 8081.
   - –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ Windows:

     ```cmd
     set AGENT_PORT=3000
     ```

     –∏–ª–∏

     ```powershell
     $env:AGENT_PORT=3000;
     ```

   - –ò–∑–º–µ–Ω–∏—Ç—å –≤ Linux:

      ```bash
      AGENT_PORT=1234
      ```

    –î–ª—è –∞–≥–µ–Ω—Ç–∞ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    - ORCHESTARTOR_ADDRESS - –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ (–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 8080)
    - COMPUTING_POWER - –≤–æ–ª-–≤–æ –≤–æ—Ä–∫–µ—Ä–æ–≤ (–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 2) 

4. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä:

```text
go run cmd/server/main.go
```

–ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≥–µ–Ω—Ç–∞:

```text
go run cmd/agent/main.go
```

5. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
   –°–æ—á–µ—Ç–∞–Ω–∏–µ –∫–ª–∞–≤–∏—à `Ctrl + C`

## –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

-Windows

```cmd
curl -X POST http://127.0.0.1:8080/api/v1/calculate -H "Content-Type: application/json" -d "{\"expression\": \"2 + 2\"}"
```

-Linux

```bash
curl -X POST http://127.0.0.1:8080/api/v1/calculate \
-H "Content-Type: application/json" \
-d '{"expression": "2 + 2"}'
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

```json
{"id":<id –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–ª-–≤–∞ –≤—ã—Ä–∞–∂–µ–Ω–∏–π –¥–æ–±–∞–≤–ª–µ–µ–Ω–Ω—ã—Ö –¥–æ>}
```

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–¢–µ—Å—Ç–∞–º–∏ –ø–æ–∫—Ä—ã—Ç—ã:

- –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä - `/internal/orchestrator/orchestrator_test.go`
- –ê–ª–≥–æ—Ä–∏—Ç–º Shunting Yard - `/pkg/calculation/calculation_test.go`

- –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
  - –ü–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é:

    ```bash
    cd <–∏–º—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –≤—ã—à–µ>
    ```

  - –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã:

    ```bash
    go test -v . 
    ```

  - –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞:
    - TestCalculateRoute
      - Valid_expression
      - Invalid_JSON
      - Invalid_expression
      - Invalid_expression
      - Malformed JSON
      - Missing_expression_field
      - Large_expression

    - TestExpressionsHandler
      - One_valid_expression
      - Multiple_valid_expressions
      - Empty_list

    - TestExpressionIdHandler
      - Valid_expression_ID
      - Invalid_expression_ID
      - Invalid_ID_format

  - –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ø–∞–∫–µ—Ç–∞ Calculation
    - TestShuntingYard
      - Valid_TwoSum
      - Valid_Expression_with_Priority
      - Valid_Expression_with_Minus
      - Valid_Expression_with_Parentheses
      - Invalid_Expression_(Mismatched_Parentheses)
      - Invalid_Expression_(Unknown_Character)

  - –ó–∞–ø—É—Å–∫ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤:

    ```bash
    go test -v -run=TestCalculateRoute/Valid_expression
    ```

    ```bash
    go test -v -run=TestShuntingYard/Valid_TwoSum
    ```

# –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

–ê—Ä—Ö–∏—Ç–µ–∫—É—Ç—Ä–Ω–æ –ø—Ä–æ–µ–∫—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö —á–∞—Å—Ç–µ–π:

- –°–µ—Ä–≤–µ—Ä (–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä)
- –ê–≥–µ–Ω—Ç

## –°–µ—Ä–≤–µ—Ä (–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä)

–£ —Å–µ—Ä–≤–µ—Ä–∞ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—É–±–ª–∏—á–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

- `/api/v1/calculate`
- `/api/v1/expressions`
- `/api/v1/expressions/{id}`

–ò –æ–¥–∏–Ω —Å–ª—É–∂–µ–±–Ω—ã–π

- `/internal/task`

---

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã `/api/v1/calculate`

1) –°–µ—Ä–≤–µ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç POST –∑–∞–ø—Ä–æ—Å;
2) –î–µ–∫–æ–¥–∏—Ä—É–µ—Ç —Ç–µ–ª–æ –∏–∑ JSON –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É Request;
3) –î–µ–ª–µ–≥–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –Ω–∞–¥ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º –º–µ—Ç–æ–¥—É handleCalculateRequest;
4) –ò—Å–ø–æ–ª—å–∑—É—è –∞–ª–≥–æ—Ä–∏—Ç–º [Shunting Yard](https://youtu.be/y_snKkv0gWc?si=Ymv6muB49Du8upEK) –æ–Ω —Ä–∞–∑–±–∏–≤–∞–µ—Ç –≤—ã—Ä–∞–∂–µ–Ω–∏–µ;
5) –ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –±—ã–ª–æ —Ä–∞–∑–±–∏—Ç–æ, –æ–Ω —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∑–∞–¥–∞—á–∏, –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ –∑–∞–≤–∏—Å–∏–º—ã–µ –∑–∞–¥–∞—á–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ `task{id}` (–ò–º–µ–Ω–Ω–æ –ø–æ—ç—Ç–æ–º—É —É –º–µ–Ω—è arg1 –∏ arg2 —Å—Ç—Ä–æ–∫–∏ –∞ –Ω–µ —á–∏—Å–ª–∞);
6) –ü–æ—Å–ª–µ —á–µ–≥–æ –æ–Ω —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –µ–≥–æ –≤ –º–∞–ø—É;
7) –í –∫–æ–Ω—Ü–µ –≤ —Å–ª–∞–π—Å –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤—Å–µ —Ç–∞—Å–∫–∏.

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã `/api/v1/expressions`

1) –°–µ—Ä–≤–µ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç GET –∑–∞–ø—Ä–æ—Å;
2) –°—Ç—Ä—É–∫—Ç—É—Ä—É ExpressionsResponse –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ –ø–æ–ª–µ Expressions (—Å–ª–∞–π—Å –∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã Expression) –≤—Å–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è;
3) –°–æ—Ä—Ç–∏—Ä—É–µ—Ç –≤—ã—Ä–∞–∂–µ–Ω–∏—è –ø–æ ID;
4) –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON –º–∞—Å—Å–∏–≤

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã `/api/v1/expressions/{id}`

1) –°–µ—Ä–≤–µ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç GET –∑–∞–ø—Ä–æ—Å;
2) –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –µ—Å—Ç—å –ª–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–¥ —Ç–∞–∫–∏–º ID;
3) –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É –∏–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞–∏—Ü—é –≤ JSON –≤ —Ñ–æ—Ä–º–∞—Ç–µ.

## –ê–≥–µ–Ω—Ç  

# Front-end

–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é –∏–ª–∏ —Å—á–∞—Å—Ç—å—é —è –Ω–µ –æ—á–µ–Ω—å –¥—Ä—É–∂—É —Å —Ñ—Ä–æ–Ω—Ç–æ–º, —è —á–∏—Å—Ç–æ backend dev üò¢